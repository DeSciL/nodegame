<!doctype html>
<title>Sorry</title>
<style>
div#errors {
  margin: 20px;
}
span.error {
  color: red;
  font-family: courier;
}

</style>
<link rel='stylesheet' href='/stylesheets/monitor.css'></link>
<body>
<div id="root">
  <h2 id="h2title">Sorry, an error has occurred</h2>
   Please try again, Go back to Amazon and click return the HIT.
</div>
<div id="errors"></div>
<div id="chatDiv">
    You can contact the game master using the chat window below. <br>
  </div>
</body>
<script src="/socket.io/socket.io.js"></script> 
<script src="/javascripts/nodegame-full.js" charset="utf-8"></script>
<script>
<!--
  window.onload = function () {
    
	  function Erroom() {
		  
		  this.solo_mode = true;
		  
         this.init = function() {
           node.widgets.append('Chat', document.getElementById('chatDiv'), {
                  mode: 'ONE_TO_ONE',
                  displayName: function() {
                    return 'Game Master';
                  }
                });
         }
         
         this.auto_step = false; 
         this.auto_wait = true;
         
         this.loop = {
        		 1: {
        			 state: function() {
        				 console.log('Error Room loaded');
        			 }
        		 }
         }
	  }
	
    // Player ID from Mturk
     var mtid = JSUS.getQueryString('id');
     
    
    var errors = {
    		'codeInUse': function() {
    			var str = 'Code already in use: ';
          var code = JSUS.getQueryString('id');
          return str + code;
    		},
    		'err0': function(){
    			var str = 'Invalid or missing authorization code: ';
    			var code = JSUS.getQueryString('id');
    			return str + code;
    		},
    		'err1': 'nodeGame general error',
    		'err2': 'insufficient screen resolution',
    		'err3': 'game play requirement not met'
    };
    
    var err, opt, errMsg, errDiv = document.getElementById('errors');
    for (var e in errors) {
    	if (errors.hasOwnProperty(e)) {
    		err = JSUS.getQueryString(e);
    		
    		if (err) {
    			errMsg = ('function' === typeof errors[e]) ? errors[e].call(this) : errors[e];
    			 
    				
    			opt = {
	              '%err': { 'class': 'error'},
	              '!e': errMsg
	        };
    			W.sprintf('%err!e%err', opt, errDiv);
    			W.writeln('', errDiv);
    		}
    	}
    }
    
    W.writeln('Your browser is: ' + navigator.userAgent, errDiv);
    
    // Create the Client
      
     var conf = {
      url: "/ultimatum/erroom",
      verbosity: 1000,
      io: {        
        reconnect: true
      },
      window: {
    	  promptOnleave: false
      },
      player: {
        mtid: mtid,
        navigator: navigator
      },
      events: {
        dumpEvents: false,
        history: false
      }
    };

    
       node.play(conf, new Erroom());
       node.game.step();
      
       
       W.noEscape(window);

  }
  // -->
</script>